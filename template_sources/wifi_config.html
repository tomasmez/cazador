<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WiFi Configuration</title>

    <script>
        function scanWiFi() {
            var spinner = document.getElementById('spinner');
            var wifiDropdown = document.getElementById('wifiDropdown');
            var passwordInput = document.getElementById('passwordInput');
    
            // Show spinner and hide WiFi dropdown and password input
            spinner.style.display = 'inline-block';
            wifiDropdown.style.display = 'none';
            passwordInput.style.display = 'none';
    
            // Fetch WiFi networks from server
            fetch('/scan_wifi')
            .then(response => response.json())
            .then(data => {
                // Clear previous dropdown options
                wifiDropdown.innerHTML = '';
    
                // Add options to the dropdown for each network
                data.networks.forEach(network => {
                    var option = document.createElement('option');
                    option.value = network[0];  // SSID
                    option.text = network[0] + ' (Power: ' + network[1] + ')';
                    wifiDropdown.appendChild(option);
                });
    
                // Show WiFi dropdown and password input
                wifiDropdown.style.display = 'block';
                passwordInput.style.display = 'block';
                spinner.style.display = 'none';
            })
            .catch(error => {
                console.error('Error:', error);
                spinner.style.display = 'none';
                alert('Falla en busqueda de redes WiFi.');
            });
        }
    </script>
    
    
</head>
<body>
    <h1>WiFi Conf </h1>

    <mark></mark><div id="quickMessage"></div></mark>

    <form id="wifiForm" action="/wifi_config" method="POST">
        <select name="wifiDropdown" id="wifiDropdown" style="display: none;"></select>
        <input type="password" name="password" id="passwordInput" placeholder="Password" style="display: none;">
        
        <div id="spinner" style="display: none;">Buscando redes WiFi...</div>
        <br><br>
        <input type="submit" value="Guardar">


    </form>
    <button onclick="scanWiFi()">Escanear redes WiFi</button>


    <script>
        // Function to show the quick message
        function showQuickMessage(message, duration) {
            var quickMessage = document.getElementById('quickMessage');
            quickMessage.innerText = message;
            quickMessage.style.display = 'block';
    
            // Hide the quick message after the specified duration
            setTimeout(function() {
                quickMessage.style.display = 'none';
            }, duration);
        }
    
        // Example: Show the message for 3 seconds
        var message = "XXXmensajeXXX";
        showQuickMessage(message, 5000);
    </script>


</body>
</html>
