<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WiFi Configuration</title>

    <script>
        function scanWiFi() {
            var spinner = document.getElementById('spinner');
            var wifiDropdown = document.getElementById('wifiDropdown');
            var passwordInput = document.getElementById('passwordInput');
    
            // Show spinner and hide WiFi dropdown and password input
            spinner.style.display = 'inline-block';
            wifiDropdown.style.display = 'none';
            passwordInput.style.display = 'none';
    
            // Fetch WiFi networks from server
            fetch('/scan_wifi')
            .then(response => response.json())
            .then(data => {
                // Clear previous dropdown options
                wifiDropdown.innerHTML = '';
    
                // Add options to the dropdown for each network
                data.networks.forEach(network => {
                    var option = document.createElement('option');
                    option.value = network[0];  // SSID
                    option.text = network[0] + ' (Power: ' + network[1] + ')';
                    wifiDropdown.appendChild(option);
                });
    
                // Show WiFi dropdown and password input
                wifiDropdown.style.display = 'block';
                passwordInput.style.display = 'block';
                spinner.style.display = 'none';
            })
            .catch(error => {
                console.error('Error:', error);
                spinner.style.display = 'none';
                alert('Falla en busqueda de redes WiFi.');
            });
        }
    </script>
    
    
</head>
<body>
    <h1>Configuraci√≥n WiFi </h1>
    <form id="wifiForm" action="/wifi_config" method="POST">
        <label for="deviceName" style="display: none;">Nombre (ej:jardin74):</label>
        <input type="text" id="deviceName" name="deviceName"  style="display: none;" required>
        <br><br>
        <select id="wifiDropdown" style="display: none;"></select>
        <input type="password" id="passwordInput" placeholder="Password" style="display: none;">
        <button onclick="scanWiFi()">Escanear redes WiFi</button>
        <div id="spinner" style="display: none;">Buscando redes WiFi...</div>
        
        <br><br>
        <input type="submit" value="Save">
    </form>
</body>
</html>
